<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>apadrinaments.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Events</li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:DOMContentLoaded">DOMContentLoaded</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#EditarAdopci%25C3%25B3">EditarAdopció</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#actualitzarApadrinament">actualitzarApadrinament</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#actualitzarEstat">actualitzarEstat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#actualitzarLoginSection">actualitzarLoginSection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#amagarFormulari">amagarFormulari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#aplicarActualitzacio">aplicarActualitzacio</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificar">btnModificar</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificarAdoptat">btnModificarAdoptat</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificarAnimal">btnModificarAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificarApadrinat">btnModificarApadrinat</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificarDonacio">btnModificarDonacio</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#btnModificarUsuari">btnModificarUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#caixaAnimals">caixaAnimals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#canviarApadrinat">canviarApadrinat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#canviarEstatAnimal">canviarEstatAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#carregarComponent">carregarComponent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#comprovarApadrinats">comprovarApadrinats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dadesAnimal">dadesAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarAnimal">editarAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarApadrinat">editarApadrinat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarDonacio">editarDonacio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarNoticia">editarNoticia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarTipusAnimal">editarTipusAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editarUsuari">editarUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarAdoptat">eliminarAdoptat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarAlerta">eliminarAlerta</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarAnimal">eliminarAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarApadrinat">eliminarApadrinat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarDonacio">eliminarDonacio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarNoticia">eliminarNoticia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarTipusAnimal">eliminarTipusAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#eliminarUsuari">eliminarUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#esborrarPass">esborrarPass</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#genere">genere</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#gestionarAdopcio">gestionarAdopcio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#gestionarApadrinacio">gestionarApadrinacio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#gestionarDonacio">gestionarDonacio</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#idUsuari">idUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#iniciarSessio">iniciarSessio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaAdoptats">llistaAdoptats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaAnimals">llistaAnimals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaApadrinats">llistaApadrinats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaDonacions">llistaDonacions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaNoticies">llistaNoticies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaTipusAnimals">llistaTipusAnimals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#llistaUsuaris">llistaUsuaris</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#login">login</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostraDadesAnimal">mostraDadesAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostraDadesUsuari">mostraDadesUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarAdoptats">mostrarAdoptats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarAlerta">mostrarAlerta</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarAnimal">mostrarAnimal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarApadrinats">mostrarApadrinats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarBotons">mostrarBotons</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarDonacions">mostrarDonacions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarFormulari">mostrarFormulari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mostrarLogin">mostrarLogin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#netejarFormulari">netejarFormulari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#obtenirImatge">obtenirImatge</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#parametre">parametre</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#passVisible">passVisible</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#registrarAnimals">registrarAnimals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#registrarNoticies">registrarNoticies</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#registrarTipusAnimals">registrarTipusAnimals</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#registrarUsuari">registrarUsuari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#scrollFormulari">scrollFormulari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#tancarSessio">tancarSessio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validarCamp">validarCamp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validarFormulari">validarFormulari</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#verificarSessio">verificarSessio</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">apadrinaments.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Gestiona el procés d'apadrinament d'un animal.
 * Comprova si l'usuari està loguejat, sol·licita una quantitat mitjançant un prompt i envia una petició al backend per registrar l'apadrinament.
 *
 * @async
 * @function gestionarApadrinacio
 * @param {number} idUsuari - L'identificador únic de l'usuari que fa l'apadrinació'.
 * @param {number} idAnimal - L'identificador únic de l'animal que és apadrinat. 
 * @param {string} baseUrl - La URL base de l'API backend.
 * @throws {Error} Llença un error si no es pot completar la petició al backend.
 */
export async function gestionarApadrinacio(idUsuari, idAnimal, baseUrl) {
    // Comprovar si l'usuari esta logejat
    if (!idUsuari) {
        alert("Si us plau, inicia sessió.");
        return;
    }

    // Data actual,elimina la part de zona horaria i temps.
    const dataAlta = new Date().toISOString().split("T")[0]; 

    // Mostra el prompt per introduir la quantitat
    const quotaMensual = prompt("Introdueix la quota per apadrinar:");
    if (quotaMensual === null) {
        alert("Apadrinació cancel·lada.");
        return;
    }
    if (!quotaMensual || isNaN(quotaMensual) || quotaMensual &lt;= 0) {
        alert("Has d'introduir una quantitat vàlida.");
        return;
    }

    // Objecte per enviar
    const apadrinament = {
        idUsuari: parseInt(idUsuari),
        idAnimal: parseInt(idAnimal),
        quotaMensual: parseFloat(quotaMensual),
        dataAlta: dataAlta
    };    

    try {
        // Petició al backend
        const queryParams = new URLSearchParams(apadrinament).toString();
        const peticio = await fetch(`${baseUrl}/api/apadrinats?${queryParams}`, {
            method: "POST",
            headers: {
                Accept: "application/json",
            },
        });

        if (!peticio.ok) {
            throw new Error(`Error ${peticio.status}: No s'ha pogut completar l'apadrinament.`);
        }

        canviarApadrinat(idAnimal, baseUrl);
        alert("Apadrinament completat correctament!");

    } catch (error) {
        console.error("Error durant l'apadrinament:", error);
    }
}

/**
 * Mostra els apadrinaments d'un usuari específic a la interfície.
 * Obté les dades d'apadrinament des del backend, filtra per usuari
 * i genera el contingut HTML per mostrar els resultats.
 *
 * @async
 * @function
 * @param {number} idUsuari - Identificador únic de l'usuari actual.
 * @param {string} baseUrl - URL base per fer les sol·licituds a l'API.
 * @param {HTMLElement} caixaApadrinats - Element del DOM on es mostrarà la informació dels apadrinaments.
 * @throws {Error} Llança un error si hi ha problemes en la sol·licitud o el processament de dades.
 */
export async function mostrarApadrinats(idUsuari, baseUrl, caixaApadrinats) {
    try {
        const peticio = await fetch(`${baseUrl}/api/apadrinats`, {
            method: "GET",
            headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
            },
        });

        if (!peticio.ok) {
            throw new Error(
                `Error ${peticio.status}: No s'ha pogut obtenir els apadrinats.`
            );
        }

        const apadrinats = await peticio.json();       

        //Variable per acumular
        let htmlApadrinats = "";

        for (let apadrinat of apadrinats) {
            if (idUsuari == apadrinat.usuaris.idUsuari) {
                htmlApadrinats += `
                    &lt;article class="text-center fondoRosa animalsUsuari">
                        &lt;h5>${apadrinat.animals.nomAnimal}&lt;/h5>
                        &lt;img class="img-fluid" src="${baseUrl}/imatges/${apadrinat.animals.foto}" alt="${apadrinat.animals.alt}">
                        &lt;p>Aportació mensual: ${apadrinat.quotaMensual}€&lt;/p>
                    &lt;/article>
                `;
            }
        }

        if (htmlApadrinats !== "") {
            htmlApadrinats += `
                &lt;p>&lt;i class="fa-solid fa-plus">&lt;/i> Pots apadrinar un altre animal aquí &amp;nbsp; 
                &lt;i class="fa-solid fa-arrow-right">&lt;/i> &amp;nbsp; &lt;a href="../tipusAnimals.html" onclick="event.stopPropagation();">Apadrinar&lt;/a>&lt;/p>
            `;
        } else {
            htmlApadrinats = `
                    &lt;p>&lt;i class="fa-solid fa-minus">&lt;/i> Encara no hi ha cap animal apadrinat.&lt;/p>
                    &lt;p>&lt;i class="fa-solid fa-minus">&lt;/i> Pots fer la teva primera apadrinació aquí &amp;nbsp; 
                    &lt;i class="fa-solid fa-arrow-right">&lt;/i> &amp;nbsp; &lt;a href="../tipusAnimals.html" onclick="event.stopPropagation();">Apadrinar&lt;/a>&lt;/p>
                `;
        }
        //Assignar el contingut acumulat
        caixaApadrinats.innerHTML = htmlApadrinats;

    } catch (error) {
        console.error("Error en mostrar els apadrinats: ", error);
        alert("Hi ha hagut un error al carregar els apadrinats.");
    }
}

/**
 * Actualitza l'apadrinament d'un animal en la base de dades.
 * 
 * Aquesta funció fa una petició GET per obtenir les dades d'un animal utilitzant el seu ID, després actualitza només el camp `apadrinat` 
 * a true, i finalment fa una petició PUT per actualitzar l'animal a la base de dades.
 * 
 * @async
 * @function canviarApadrinat
 * @param {number} idAnimal - L'ID de l'animal que es vol actualitzar.
 * @param {string} baseUrl - La URL base del servidor on s'executa l'API.
 * @throws {Error} Llença un error si no es pot obtenir o actualitzar l'animal.
 */
async function canviarApadrinat(idAnimal, baseUrl) {
    try {
        // Obtenir l'animal complet
        const resposta = await fetch(`${baseUrl}/api/animal/${idAnimal}`, {
            method: "GET",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          });
        if (!resposta.ok) {
            throw new Error(
                `Error ${resposta.status}: No s'ha pogut obtenir l'animal.`
            );
        }

        // Convertir la resposta a JSON
        const animal = await resposta.json();

        // Actualitzar només el camp 'estat'
        animal.apadrinat = true;

        // Enviar l'animal actualitzat al backend
        const peticio = await fetch(`${baseUrl}/api/animals`, {
            method: "PUT",
            headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
            },
            body: JSON.stringify(animal), // Enviar l'objecte complet
        });

        if (!peticio.ok) {
            throw new Error(
                `Error ${peticio.status}: No s'ha pogut actualitzar l'animal.`
            );
        }

        alert("Apadrinament de l'animal s'ha actualitzat correctament!");

    } catch (error) {
        console.error("Error en la sol·licitud:", error);
        alert("Error de connexió o en el servidor.");
    }
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Tue Dec 03 2024 10:56:12 GMT+0100 (hora estándar de Europa central) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
